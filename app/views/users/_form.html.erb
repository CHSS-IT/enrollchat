<%= form_for(user) do |f| %>
  <% if user.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(user.errors.count, "error") %> prohibited this user from being saved:</h2>
      <ul>
      <% user.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-lg-12">
    <div class="card mt-3">
      <div class="card-body">
        <div class="col-lg-12">
        <div class="mb-3 row">
            <%= f.label :first_name, class: "col-md-3 col-form-label" %>
            <div class="col-md-8">
            <% if current_user.try(:admin?) %>
                <%= f.text_field :first_name, class: 'form-control' %>
            <% else %>
                <%= @user.first_name %>
            <% end %>
            </div>
        </div>

        <div class="mb-3 row">
            <%= f.label :last_name, class: "col-md-3 col-form-label" %>
            <div class="col-md-8">
            <% if current_user.try(:admin?) %>
                <%= f.text_field :last_name, class: 'form-control' %>
            <% else %>
                <%= @user.last_name %>
            <% end %>
            </div>
        </div>

        <div class="mb-3 row">
            <%= f.label :email, class: "col-md-3 col-form-label" %>
            <div class="col-md-8">
            <% if current_user.try(:admin?) %>
                <%= f.email_field :email, class: 'form-control' %>
            <% else %>
                <%= @user.email %>
            <% end %>
            </div>
        </div>

        <div class="mb-3 row">
            <%= f.label :username, class: "col-md-3 col-form-label" %>
            <div class="col-md-8">
            <% if current_user.try(:admin?) %>
                <%= f.text_field :username, class: 'form-control' %>
            <% else %>
                <%= @user.username %>
            <% end %>
            </div>
        </div>

        <div class="mb-3 row">
            <%= f.label :status, class: "col-md-3 col-form-label" %>
            <div class="col-md-6">
            <% if current_user.try(:admin?) %>
                <%= f.select :status, User.status_list, {default: 'active'}, {class: 'form-select'} %>
            <% else %>
                <%= @user.status %>
            <% end %>
            </div>
        </div>

        <div class="mb-3 row">
            <%= f.label :email_preference, class: "col-md-3 col-form-label" %>
            <div class="col-md-6">
            <%= f.select :email_preference, User.email_options, {include_blank: false}, {class: 'form-select'} %>
            <small id="passwordHelpBlock" class="form-text text-muted">
                You may choose to receive an email each time a comment is posted on your program(s), a daily digest of comments, both, or neither.
            </small>
            </div>
        </div>

        <div class="mb-3 row">
            <%= f.label :departments, class: "col-md-3 col-form-label" %>
            <div class="col-md-6">
            <%= f.select :departments, Section.department_list, {include_blank: false}, {multiple: 'true', class: 'form-select'} %>
            <small id="passwordHelpBlock" class="form-text text-muted">
                Select one or more departments if you wish to limit your alerts and emails to comments that are relevant to you. <br>
                Mac users: Hold the <kbd>Command</kbd> key and click to select multiple options. <br>
                Windows users: Hold the <kbd>Ctrl</kbd> (Control) key and click to select multiple options.
            </small>
            </div>
        </div>

        <div class="mb-3 row">
            <%= f.label :no_weekly_report, class: "col-md-3 col-form-label" %>
            <div class="col-md-9">
            <%= f.check_box :no_weekly_report %>
            <small id="passwordHelpBlock" class="form-text text-muted">
                If you check this box, you will not receive the weekly report on the status of your programs.
            </small>
            </div>
        </div>

        <% if current_user.try(:admin?) %>
            <div class="mb-3 row">
            <%= f.label :admin, class: "col-md-3 col-form-label" %>
            <div class="col-md-9">
                <%= f.check_box :admin %>
            </div>
            </div>
        <% end %>

        <div class="mb-3 d-flex">
            <%= submit_tag 'Save', class: 'btn btn-lg btn-primary me-2' %>
            <% if current_user.try(:admin?) %>
            <%= link_to 'Cancel', users_path, class: 'btn btn-lg btn-secondary' %>
            <% else %>
            <%= link_to 'Cancel', sections_path, class: 'btn btn-lg btn-secondary' %>
            <% end %>
            <% if current_user.try(:admin?) %>
            <% unless @user.new_record? %>
                <%= link_to 'Archive', archive_user_path(@user), data: { confirm: 'Are you sure you want to archive this user?'}, class: 'btn btn-lg btn-warning ms-2' %>
            <% end %>
            <% end %>
        </div>

        </div>
      </div>
    </div>
    </div>
  </div>
<% end %>
<h1>EnrollChat Report</h1>
<p>This report shows the enrollment state of your programs and a summary of recent comments.</p>
<p>To change your preferences, log into EnrollChat and click <%= link_to "Preferences", edit_user_url(@recipient) %>.</p>
<p>View the daily report <%= link_to "within EnrollChat", report_url %>.</p>

<hr />

<table cellspacing="0" cellpadding="4" rules="rows" style="color:#1f2240;background-color:#ffffff">
  <thead style="100%;color:#ffffff;background-color:#1f2240;font-weight:bold">
  <tr>
    <th scope="col">Department</th>
    <th scope="col">Active Sections</th>
    <th scope="col">Under-Enrolled</th>
    <th scope="col">Full</th>
    <th scope="col">Over-Enrolled</th>
    <th scope="col">Canceled Sections</th>
    <th scope="col">Comments This Week</th>
    <th scope="col">Most Recent Comment</th>
    <th scope="col">Enrollment Limit</th>
    <th scope="col">Actual Enrollment</th>
    <th scope="col">Cross-List Enrollment</th>
    <th scope="col">Waitlist</th>
  </tr>
  </thead>
  <tbody>
  <% @recipient.reporting_departments.each do |department| %>
      <% sections = Section.in_term(@term).in_department(department) %>
      <tr>
        <td><%= department %></td>
        <td style="text-align: right"><%= sections.not_canceled.size %></td>
        <td style="text-align: right"><%= sections.flagged_as?('under_enrolled').size %></td>
        <td style="text-align: right"><%= sections.full.size %></td>
        <td style="text-align: right"><%= sections.flagged_as?('over-enrolled').size %></td>
        <td style="text-align: right"><%= sections.canceled.size %></td>
        <td style="text-align: right"><%= Comment.for_department(department).in_past_week.size %></td>
        <td style="text-align: right"><%= basic_datetime(Comment.for_department(department).in_term(@term).most_recent) %></td>
        <td style="text-align: right"><%= sections.not_canceled.sum(:enrollment_limit) %><%#= arrow(sections.not_canceled.sum(:enrollment_limit_yesterday)) %></td>
        <td style="text-align: right"><%= sections.not_canceled.sum(:actual_enrollment) %><%#= arrow(sections.not_canceled.sum(:actual_enrollment_yesterday)) %></td>
        <td style="text-align: right"><%= sections.not_canceled.sum(:cross_list_enrollment) %><%#= arrow(sections.not_canceled.sum(:cross_list_enrollment_yesterday)) %></td>
        <td style="text-align: right"><%= sections.not_canceled.sum(:waitlist) %><%#= arrow(sections.not_canceled.sum(:waitlist_yesterday)) %></td>
      </tr>
  <% end %>
  </tbody>
</table>


<style>
  /* Cells in even rows (2,4,6...) are one color */
  tr:nth-child(even) td { background: #F1F1F1; }

  /* Cells in odd rows (1,3,5...) are another (excludes header cells)  */
  tr:nth-child(odd) td { background: #FEFEFE; }

  tr td:hover { background: #666; color: #FFF; }
  /* Hover cell effect! */

</style>